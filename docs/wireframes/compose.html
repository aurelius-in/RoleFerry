<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Compose - RoleFerry</title>
<link rel="stylesheet" href="../styles.css" />
<link rel="stylesheet" href="responsive.css" />
<link rel="icon" href="../assets/roleferry_trans.png" />
<style>
  .tab-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
    padding: 2rem;
  }

  .tab-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .tab-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 1rem;
  }

  .tab-subtitle {
    font-size: 1.1rem;
    color: #9ca3af;
    margin-bottom: 2rem;
  }

  .form-container {
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(31, 41, 55, 0.8);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid #374151;
  }

  .compose-section {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .email-composer {
    background: rgba(17, 24, 39, 0.8);
    border: 1px solid #374151;
    border-radius: 12px;
    padding: 1.5rem;
  }

  .email-composer h3 {
    color: #ffffff;
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1rem;
    border-bottom: 2px solid #2563eb;
    padding-bottom: 0.5rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    color: #ffffff;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .form-input, .form-textarea {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #374151;
    border-radius: 8px;
    background: rgba(17, 24, 39, 0.8);
    color: #ffffff;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .form-input:focus, .form-textarea:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .form-textarea {
    min-height: 300px;
    resize: vertical;
  }

  .variables-panel {
    background: rgba(17, 24, 39, 0.8);
    border: 1px solid #374151;
    border-radius: 12px;
    padding: 1.5rem;
    height: fit-content;
  }

  .variables-panel h3 {
    color: #ffffff;
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1rem;
    border-bottom: 2px solid #10b981;
    padding-bottom: 0.5rem;
  }

  .variable-item {
    background: rgba(37, 99, 235, 0.1);
    border: 1px solid #2563eb;
    border-radius: 8px;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .variable-item:hover {
    background: rgba(37, 99, 235, 0.2);
    border-color: #1d4ed8;
  }

  .variable-item code {
    color: #10b981;
    font-family: 'Courier New', monospace;
    font-weight: 600;
  }

  .variable-item p {
    color: #d1d5db;
    font-size: 0.9rem;
    margin: 0.25rem 0 0 0;
  }

  .tone-selector {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    justify-content: center;
  }

  .tone-btn {
    padding: 12px 24px;
    background: rgba(55, 65, 81, 0.8);
    color: #9ca3af;
    border: 2px solid #374151;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
  }

  .tone-btn.active {
    background: #2563eb;
    color: white;
    border-color: #2563eb;
  }

  .tone-btn:hover {
    border-color: #6b7280;
    color: #ffffff;
  }

  .jargon-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .jargon-toggle input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #2563eb;
  }

  .jargon-toggle label {
    color: #d1d5db;
    font-size: 0.9rem;
  }

  .jargon-detection {
    background: rgba(245, 158, 11, 0.1);
    border: 1px solid #f59e0b;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    display: none;
  }

  .jargon-detection.show {
    display: block;
  }

  .jargon-detection h4 {
    color: #f59e0b;
    margin-bottom: 0.5rem;
    font-size: 1rem;
  }

  .jargon-detection ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .jargon-detection li {
    color: #d1d5db;
    margin-bottom: 0.25rem;
    font-size: 0.9rem;
  }

  .jargon-detection strong {
    color: #f59e0b;
  }

  .email-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
  }

  .btn-primary {
    padding: 12px 32px;
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4);
  }

  .btn-secondary {
    padding: 12px 32px;
    background: transparent;
    color: #9ca3af;
    border: 2px solid #374151;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-secondary:hover {
    border-color: #6b7280;
    color: #ffffff;
  }

  .loading-spinner {
    display: none;
    text-align: center;
    margin: 2rem 0;
  }

  .loading-spinner.show {
    display: block;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #374151;
    border-top: 4px solid #2563eb;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .back-button {
    position: fixed;
    top: 2rem;
    left: 2rem;
    padding: 12px 24px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .back-button:hover {
    background: rgba(0, 0, 0, 0.9);
  }

  .progress-indicator {
    position: fixed;
    top: 2rem;
    right: 2rem;
    background: rgba(0, 0, 0, 0.8);
    padding: 1rem;
    border-radius: 12px;
    color: white;
    font-weight: 600;
  }

  .progress-bar {
    width: 200px;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 0.5rem;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #2563eb, #10b981);
    transition: width 0.3s ease;
  }

  .success-message {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid #10b981;
    border-radius: 8px;
    padding: 1rem;
    color: #10b981;
    margin-bottom: 1rem;
    display: none;
  }

  .success-message.show {
    display: block;
  }

  .email-preview {
    background: rgba(17, 24, 39, 0.8);
    border: 1px solid #374151;
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 2rem;
  }

  .email-preview h3 {
    color: #ffffff;
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1rem;
    border-bottom: 2px solid #10b981;
    padding-bottom: 0.5rem;
  }

  .email-preview-content {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 1rem;
    color: #d1d5db;
    line-height: 1.6;
    white-space: pre-wrap;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .tab-container {
      padding: 1rem;
    }
    .tab-title {
      font-size: 2rem;
    }
    .form-container {
      padding: 1.5rem;
    }
    .compose-section {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    .variables-panel {
      order: -1;
    }
    .back-button {
      position: relative;
      top: auto;
      left: auto;
      margin-bottom: 1rem;
    }
    .progress-indicator {
      position: relative;
      top: auto;
      right: auto;
      margin-bottom: 1rem;
    }
    .tone-selector {
      flex-direction: column;
      gap: 1rem;
    }
  }

  @media (max-width: 480px) {
    .tab-container {
      padding: 0.5rem;
    }
    .tab-title {
      font-size: 1.5rem;
    }
    .form-container {
      padding: 1rem;
    }
    .tone-btn {
      padding: 1rem;
      font-size: 1rem;
    }
    .btn-primary, .btn-secondary {
      width: 100%;
      margin-bottom: 0.5rem;
    }
    .email-actions {
      flex-direction: column;
    }
    .form-textarea {
      min-height: 200px;
    }
  }
</style>
</head>
<body>
  <div class="tab-container">
    <!-- Back Button -->
    <button class="back-button" onclick="goBack()">← Back to Keypad</button>

    <!-- Progress Indicator -->
    <div class="progress-indicator">
      <div>Step 8 of 10</div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 80%"></div>
      </div>
    </div>

    <!-- Header -->
    <div class="tab-header">
      <h1 class="tab-title">Compose</h1>
      <p class="tab-subtitle">Generate personalized emails with variable substitution and jargon clarity</p>
    </div>

    <!-- Success Message -->
    <div class="success-message" id="successMessage">
      ✅ Email composed successfully! Your personalized message is ready for the campaign.
    </div>

    <!-- Form Container -->
    <div class="form-container">
      <!-- Compose Section -->
      <div class="compose-section">
        <!-- Email Composer -->
        <div class="email-composer">
          <h3>Email Composer</h3>
          
          <!-- Tone Selector -->
          <div class="tone-selector">
            <button class="tone-btn active" onclick="selectTone('recruiter')">Recruiter</button>
            <button class="tone-btn" onclick="selectTone('manager')">Manager</button>
            <button class="tone-btn" onclick="selectTone('exec')">Executive</button>
          </div>

          <!-- Jargon Toggle -->
          <div class="jargon-toggle">
            <input type="checkbox" id="jargonToggle" onchange="toggleJargon()">
            <label for="jargonToggle">Simplify Language (replace jargon with definitions)</label>
          </div>

          <!-- Jargon Detection -->
          <div class="jargon-detection" id="jargonDetection">
            <h4>Jargon Detected:</h4>
            <ul>
              <li><strong>API</strong>: Application Programming Interface</li>
              <li><strong>KPI</strong>: Key Performance Indicator</li>
              <li><strong>ROI</strong>: Return On Investment</li>
            </ul>
          </div>

          <div class="form-group">
            <label class="form-label" for="emailSubject">Subject Line</label>
            <input type="text" class="form-input" id="emailSubject" placeholder="Enter email subject...">
          </div>

          <div class="form-group">
            <label class="form-label" for="emailBody">Email Body</label>
            <textarea class="form-textarea" id="emailBody" placeholder="Enter email body..."></textarea>
          </div>
        </div>

        <!-- Variables Panel -->
        <div class="variables-panel">
          <h3>Available Variables</h3>
          
          <div class="variable-item" onclick="insertVariable('{{first_name}}')">
            <code>{{first_name}}</code>
            <p>Contact's first name</p>
          </div>
          
          <div class="variable-item" onclick="insertVariable('{{company_name}}')">
            <code>{{company_name}}</code>
            <p>Company name</p>
          </div>
          
          <div class="variable-item" onclick="insertVariable('{{job_title}}')">
            <code>{{job_title}}</code>
            <p>Job title/position</p>
          </div>
          
          <div class="variable-item" onclick="insertVariable('{{pinpoint_1}}')">
            <code>{{pinpoint_1}}</code>
            <p>Main pain point</p>
          </div>
          
          <div class="variable-item" onclick="insertVariable('{{solution_1}}')">
            <code>{{solution_1}}</code>
            <p>Your solution</p>
          </div>
          
          <div class="variable-item" onclick="insertVariable('{{metric_1}}')">
            <code>{{metric_1}}</code>
            <p>Key metric/result</p>
          </div>
          
          <div class="variable-item" onclick="insertVariable('{{company_summary}}')">
            <code>{{company_summary}}</code>
            <p>Company overview</p>
          </div>
          
          <div class="variable-item" onclick="insertVariable('{{recent_news}}')">
            <code>{{recent_news}}</code>
            <p>Recent company news</p>
          </div>
          
          <div class="variable-item" onclick="insertVariable('{{contact_bio}}')">
            <code>{{contact_bio}}</code>
            <p>Contact background</p>
          </div>
        </div>
      </div>

      <!-- Email Preview -->
      <div class="email-preview" id="emailPreview" style="display: none;">
        <h3>Email Preview</h3>
        <div class="email-preview-content" id="emailPreviewContent"></div>
      </div>

      <!-- Email Actions -->
      <div class="email-actions">
        <button class="btn-secondary" onclick="generateEmail()">Generate Email</button>
        <button class="btn-primary" onclick="saveEmail()">Save & Proceed</button>
      </div>
    </div>
  </div>

  <script>
    let currentTone = 'recruiter';
    let jargonEnabled = false;

    function selectTone(tone) {
      currentTone = tone;
      
      // Update button states
      document.querySelectorAll('.tone-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Regenerate email based on tone
      generateEmail();
    }

    function toggleJargon() {
      jargonEnabled = document.getElementById('jargonToggle').checked;
      
      if (jargonEnabled) {
        document.getElementById('jargonDetection').classList.add('show');
        // Apply jargon simplification
        simplifyLanguage();
      } else {
        document.getElementById('jargonDetection').classList.remove('show');
        // Restore original text
        generateEmail();
      }
    }

    function simplifyLanguage() {
      const emailBody = document.getElementById('emailBody');
      let content = emailBody.value;
      
      // Replace jargon with definitions
      const jargonMap = {
        'API': 'Application Programming Interface (API)',
        'KPI': 'Key Performance Indicator (KPI)',
        'ROI': 'Return On Investment (ROI)',
        'SaaS': 'Software as a Service (SaaS)',
        'B2B': 'Business to Business (B2B)',
        'CRM': 'Customer Relationship Management (CRM)',
        'SEO': 'Search Engine Optimization (SEO)',
        'UX': 'User Experience (UX)',
        'UI': 'User Interface (UI)',
        'MVP': 'Minimum Viable Product (MVP)'
      };
      
      for (const [term, definition] of Object.entries(jargonMap)) {
        content = content.replace(new RegExp(`\\b${term}\\b`, 'gi'), definition);
      }
      
      emailBody.value = content;
    }

    function insertVariable(variable) {
      const emailBody = document.getElementById('emailBody');
      const cursorPos = emailBody.selectionStart;
      const textBefore = emailBody.value.substring(0, cursorPos);
      const textAfter = emailBody.value.substring(cursorPos);
      
      emailBody.value = textBefore + variable + textAfter;
      emailBody.focus();
      emailBody.setSelectionRange(cursorPos + variable.length, cursorPos + variable.length);
    }

    function generateEmail() {
      // Show loading spinner
      const spinner = document.createElement('div');
      spinner.className = 'loading-spinner show';
      spinner.innerHTML = '<div class="spinner"></div><p>AI is generating your email...</p>';
      document.querySelector('.compose-section').appendChild(spinner);

      // Simulate AI generation
      setTimeout(() => {
        spinner.remove();
        
        let subject = '';
        let body = '';
        
        if (currentTone === 'recruiter') {
          subject = 'Quick advice on {{job_title}} at {{company_name}}?';
          body = `Hi {{first_name}},

I noticed the {{job_title}} role at {{company_name}} and was particularly interested in your focus on {{pinpoint_1}}. My background in {{solution_1}} has consistently led to results like {{metric_1}}. I believe my skills are a strong fit for your team's needs.

Would you be open to a brief chat to discuss how my experience can help with your current challenges?

Best,
[Your Name]`;
        } else if (currentTone === 'manager') {
          subject = 'Regarding {{job_title}} position - {{company_name}}';
          body = `Hi {{first_name}},

Regarding the {{job_title}} position, I understand the team is tackling {{pinpoint_1}}. My approach, leveraging {{solution_1}}, has previously achieved {{metric_1}}. I'm keen to explore how I can contribute to your team's objectives.

I've also kept up with {{company_name}}'s recent news, specifically {{recent_news}}, and see a clear alignment with my career goals.

Best,
[Your Name]`;
        } else { // exec tone
          subject = 'Strategic discussion: {{job_title}} at {{company_name}}';
          body = `Hi {{first_name}},

Given {{company_name}}'s strategic focus on {{company_summary}} and recent developments like {{recent_news}}, I believe my expertise in addressing {{pinpoint_1}} with solutions like {{solution_1}} could be highly valuable. I've consistently delivered {{metric_1}} in similar contexts.

I'd appreciate the opportunity for a brief discussion on how my strategic contributions can support your overarching goals.

Best,
[Your Name]`;
        }
        
        document.getElementById('emailSubject').value = subject;
        document.getElementById('emailBody').value = body;
        
        // Show preview
        showPreview();
        
        alert('Email generated successfully!');
      }, 2000);
    }

    function showPreview() {
      const preview = document.getElementById('emailPreview');
      const previewContent = document.getElementById('emailPreviewContent');
      
      const subject = document.getElementById('emailSubject').value;
      const body = document.getElementById('emailBody').value;
      
      previewContent.textContent = `Subject: ${subject}\n\n${body}`;
      preview.style.display = 'block';
    }

    function saveEmail() {
      const emailData = {
        tone: currentTone,
        subject: document.getElementById('emailSubject').value,
        body: document.getElementById('emailBody').value,
        jargonEnabled: jargonEnabled,
        timestamp: new Date().toISOString()
      };
      
      localStorage.setItem('roleferry_email_data', JSON.stringify(emailData));
      
      document.getElementById('successMessage').classList.add('show');
      
      setTimeout(() => {
        alert('Email saved successfully! You can now proceed to the next step.');
      }, 500);
    }

    function goBack() {
      window.location.href = '../index.html';
    }

    // Load saved data if exists
    const savedData = localStorage.getItem('roleferry_email_data');
    if (savedData) {
      const data = JSON.parse(savedData);
      if (data.subject) {
        document.getElementById('emailSubject').value = data.subject;
        document.getElementById('emailBody').value = data.body;
        currentTone = data.tone || 'recruiter';
        jargonEnabled = data.jargonEnabled || false;
        
        // Update button states
        document.querySelectorAll('.tone-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.textContent.toLowerCase().includes(currentTone)) {
            btn.classList.add('active');
          }
        });
        
        document.getElementById('jargonToggle').checked = jargonEnabled;
        if (jargonEnabled) {
          document.getElementById('jargonDetection').classList.add('show');
        }
        
        showPreview();
      }
    }

    // Auto-generate email on load
    generateEmail();
  </script>
</body>
</html>
