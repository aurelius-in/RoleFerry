<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Job Preferences - RoleFerry</title>
<link rel="stylesheet" href="../styles.css" />
<link rel="stylesheet" href="responsive.css" />
<link rel="icon" href="../assets/roleferry_trans.png" />
<script src="api-utils.js"></script>
<style>
  .tab-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f172a 100%);
    padding: 2rem;
  }

  .tab-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .branding-section {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .wordmark-logo {
    height: 50px;
    width: auto;
  }

  .animated-logo {
    height: 50px;
    width: auto;
  }

  .tab-title {
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(45deg, #FF6B35, #FFD23F);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
  }

  .tab-subtitle {
    font-size: 1.1rem;
    color: #9ca3af;
    margin-bottom: 2rem;
  }

  .form-container {
    max-width: 900px;
    margin: 0 auto;
    background: rgba(31, 41, 55, 0.8);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid #374151;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-label {
    font-size: 1rem;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 0.5rem;
  }

  .form-input, .form-select, .form-textarea {
    padding: 12px 16px;
    border: 2px solid #374151;
    border-radius: 8px;
    background: rgba(17, 24, 39, 0.8);
    color: #ffffff;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: #4A90E2;
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
  }

  .form-select[multiple] {
    min-height: 120px;
  }

  .form-textarea {
    min-height: 100px;
    resize: vertical;
  }

  .form-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
  }

  .btn-primary {
    padding: 12px 32px;
    background: linear-gradient(135deg, #FF6B35 0%, #FFD23F 100%);
    color: #1a1a1a;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
  }

  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-secondary {
    padding: 12px 32px;
    background: transparent;
    color: #9ca3af;
    border: 2px solid #374151;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-secondary:hover {
    border-color: #6b7280;
    color: #ffffff;
  }

  .back-button {
    position: fixed;
    top: 2rem;
    left: 2rem;
    padding: 12px;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    border: 2px solid rgba(74, 144, 226, 0.5);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    font-weight: 600;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .back-button svg {
    width: 24px;
    height: 24px;
    fill: currentColor;
  }

  .back-button:hover {
    background: rgba(74, 144, 226, 0.9);
  }

  .next-button {
    position: fixed;
    top: 2rem;
    right: 2rem;
    padding: 12px 24px;
    background: linear-gradient(135deg, #4A90E2 0%, #87CEEB 100%);
    color: #1a1a1a;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    font-weight: 700;
    z-index: 100;
  }

  .next-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(74, 144, 226, 0.4);
  }

  .progress-indicator {
    position: fixed;
    top: 5rem;
    right: 2rem;
    background: rgba(0, 0, 0, 0.9);
    padding: 1rem;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    border: 2px solid rgba(74, 144, 226, 0.5);
    z-index: 100;
  }

  .success-message {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid #10b981;
    border-radius: 8px;
    padding: 1rem;
    color: #10b981;
    margin-bottom: 1rem;
    display: none;
  }

  .success-message.show {
    display: block;
  }

  .error-message {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid #ef4444;
    border-radius: 8px;
    padding: 1rem;
    color: #ef4444;
    margin-bottom: 1rem;
    display: none;
  }

  .error-message.show {
    display: block;
  }

  .loading {
    opacity: 0.6;
    pointer-events: none;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .tab-container {
      padding: 1rem;
    }
    
    .tab-title {
      font-size: 2rem;
    }
    
    .form-container {
      padding: 1.5rem;
    }
    
    .form-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    .back-button, .next-button {
      position: relative;
      top: auto;
      left: auto;
      right: auto;
      margin-bottom: 1rem;
      display: inline-block;
    }
    
    .progress-indicator {
      position: relative;
      top: auto;
      right: auto;
      margin-bottom: 1rem;
    }
  }
</style>
</head>
<body>
  <div class="tab-container">
    <!-- Navigation -->
    <a href="../wireframes.html" class="back-button" title="Back to Path">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
      </svg>
    </a>
    <a href="candidate-profile.html" class="next-button">Your Profile →</a>

    <!-- Progress Indicator -->
    <div class="progress-indicator">
      <div>Step 2 of 12</div>
    </div>

    <!-- Header -->
    <div class="tab-header">
      <div class="branding-section">
        <img src="../wordmark.png" alt="RoleFerry" class="wordmark-logo">
        <img src="../ani-sm.gif" alt="RoleFerry Animation" class="animated-logo">
      </div>
      <h1 class="tab-title">Job Preferences</h1>
      <p class="tab-subtitle">Tell us what you're looking for in your next role</p>
    </div>

    <!-- Success/Error Messages -->
    <div class="success-message" id="successMessage">
      ✅ Job preferences saved successfully! You can now proceed to the next step.
    </div>
    <div class="error-message" id="errorMessage"></div>

    <!-- Form Container -->
    <div class="form-container">
      <form id="preferencesForm">
        <div class="form-grid">
          <!-- Work Values -->
          <div class="form-group">
            <label class="form-label" for="values">Work Values (Select up to 3)</label>
            <select class="form-select" id="values" multiple>
              <option value="">Loading values...</option>
            </select>
          </div>

          <!-- Role Categories -->
          <div class="form-group">
            <label class="form-label" for="roleCategories">Role Categories</label>
            <select class="form-select" id="roleCategories" multiple>
              <option value="">Loading categories...</option>
            </select>
          </div>

          <!-- Location Preferences -->
          <div class="form-group">
            <label class="form-label" for="locationPreferences">Location Preferences</label>
            <select class="form-select" id="locationPreferences" multiple>
              <option value="Remote">Remote</option>
              <option value="Hybrid">Hybrid</option>
              <option value="On-site">On-site</option>
            </select>
          </div>

          <!-- Work Type -->
          <div class="form-group">
            <label class="form-label" for="workType">Work Type</label>
            <select class="form-select" id="workType" multiple>
              <option value="Full-Time">Full-Time</option>
              <option value="Part-Time">Part-Time</option>
              <option value="Contract">Contract</option>
              <option value="Freelance">Freelance</option>
            </select>
          </div>

          <!-- Role Type -->
          <div class="form-group">
            <label class="form-label" for="roleType">Role Type</label>
            <select class="form-select" id="roleType" multiple>
              <option value="Individual Contributor">Individual Contributor</option>
              <option value="Manager">Manager</option>
              <option value="Director">Director</option>
              <option value="VP">VP</option>
              <option value="C-Level">C-Level</option>
            </select>
          </div>

          <!-- Company Size -->
          <div class="form-group">
            <label class="form-label" for="companySize">Company Size</label>
            <select class="form-select" id="companySize" multiple>
              <option value="1-50 employees">1-50 employees</option>
              <option value="51-200 employees">51-200 employees</option>
              <option value="201-500 employees">201-500 employees</option>
              <option value="501-1000 employees">501-1000 employees</option>
              <option value="1000+ employees">1000+ employees</option>
            </select>
          </div>

          <!-- Industries -->
          <div class="form-group">
            <label class="form-label" for="industries">Industries</label>
            <select class="form-select" id="industries" multiple>
              <option value="">Loading industries...</option>
            </select>
          </div>

          <!-- Skills -->
          <div class="form-group">
            <label class="form-label" for="skills">Skills</label>
            <select class="form-select" id="skills" multiple>
              <option value="">Loading skills...</option>
            </select>
          </div>

          <!-- Minimum Salary -->
          <div class="form-group">
            <label class="form-label" for="minimumSalary">Minimum Salary</label>
            <input type="text" class="form-input" id="minimumSalary" placeholder="e.g., $80,000">
          </div>

          <!-- Job Search Status -->
          <div class="form-group">
            <label class="form-label" for="jobSearchStatus">Job Search Status</label>
            <select class="form-select" id="jobSearchStatus">
              <option value="">Select status...</option>
              <option value="Actively looking">Actively looking</option>
              <option value="Open to opportunities">Open to opportunities</option>
              <option value="Not actively looking">Not actively looking</option>
            </select>
          </div>

          <!-- State -->
          <div class="form-group">
            <label class="form-label" for="state">State (Optional)</label>
            <input type="text" class="form-input" id="state" placeholder="e.g., California">
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="resetForm()">Reset</button>
          <button type="submit" class="btn-primary" id="submitBtn">Save Preferences</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let optionsLoaded = false;

    // Load options from Mock Data
    async function loadOptions() {
      try {
        // Simulate network delay slightly for realism, but always succeed
        await new Promise(resolve => setTimeout(resolve, 100)); 

        // Mock Data for Options
        const mockOptions = {
            values: ["Innovation", "Growth", "Impact", "Mission-Driven", "Diversity", "Work-Life Balance", "Autonomy", "Collaboration", "Compensation", "Learning"],
            roleCategories: ["Product Management", "Engineering", "Data Science", "Design", "Sales", "Marketing", "Customer Success"],
            industries: ["Software & Technology", "AI & Machine Learning", "FinTech", "Healthcare", "E-commerce", "Enterprise Software", "Cybersecurity"],
            skills: ["Python", "React", "AWS", "Machine Learning", "Docker", "Kubernetes", "PostgreSQL", "JavaScript", "TypeScript", "Node.js", "Java", "Go", "C++"]
        };

        // Populate values
        const valuesSelect = document.getElementById('values');
        valuesSelect.innerHTML = '<option value="">Select work values...</option>';
        mockOptions.values.forEach(value => {
          const option = document.createElement('option');
          option.value = value;
          option.textContent = value;
          valuesSelect.appendChild(option);
        });

        // Populate role categories
        const roleCategoriesSelect = document.getElementById('roleCategories');
        roleCategoriesSelect.innerHTML = '<option value="">Select role categories...</option>';
        mockOptions.roleCategories.forEach(category => {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = category;
          roleCategoriesSelect.appendChild(option);
        });

        // Populate industries
        const industriesSelect = document.getElementById('industries');
        industriesSelect.innerHTML = '<option value="">Select industries...</option>';
        mockOptions.industries.forEach(industry => {
          const option = document.createElement('option');
          option.value = industry;
          option.textContent = industry;
          industriesSelect.appendChild(option);
        });

        // Populate skills
        const skillsSelect = document.getElementById('skills');
        skillsSelect.innerHTML = '<option value="">Select skills...</option>';
        mockOptions.skills.forEach(skill => {
          const option = document.createElement('option');
          option.value = skill;
          option.textContent = skill;
          skillsSelect.appendChild(option);
        });

        optionsLoaded = true;
      } catch (error) {
        console.error('Error loading options:', error);
        // Even on error, we don't show failure message in demo mode
        // Just log it and maybe set default values if critical
      }
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.classList.add('show');
      setTimeout(() => {
        errorDiv.classList.remove('show');
      }, 5000);
    }

    function showSuccess() {
      const successDiv = document.getElementById('successMessage');
      successDiv.classList.add('show');
    }

    // Form Submission
    document.getElementById('preferencesForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      document.getElementById('preferencesForm').classList.add('loading');

      try {
        // Collect form data matching API structure
        const preferences = {
          values: Array.from(document.getElementById('values').selectedOptions).map(opt => opt.value).filter(v => v),
          role_categories: Array.from(document.getElementById('roleCategories').selectedOptions).map(opt => opt.value).filter(v => v),
          location_preferences: Array.from(document.getElementById('locationPreferences').selectedOptions).map(opt => opt.value).filter(v => v),
          work_type: Array.from(document.getElementById('workType').selectedOptions).map(opt => opt.value).filter(v => v),
          role_type: Array.from(document.getElementById('roleType').selectedOptions).map(opt => opt.value).filter(v => v),
          company_size: Array.from(document.getElementById('companySize').selectedOptions).map(opt => opt.value).filter(v => v),
          industries: Array.from(document.getElementById('industries').selectedOptions).map(opt => opt.value).filter(v => v),
          skills: Array.from(document.getElementById('skills').selectedOptions).map(opt => opt.value).filter(v => v),
          minimum_salary: document.getElementById('minimumSalary').value || '',
          job_search_status: document.getElementById('jobSearchStatus').value || '',
          state: document.getElementById('state').value || null,
          user_mode: 'job-seeker'
        };

        // Save to backend
        const response = await JobPreferencesAPI.save(preferences);
        
        if (response.success) {
          // Also save to localStorage as backup
          localStorage.setItem('roleferry_preferences', JSON.stringify(preferences));
          showSuccess();
          
          // Update progress in main wireframes page
          const completedSteps = JSON.parse(localStorage.getItem('roleferry-progress') || '[]');
          if (!completedSteps.includes(2)) {
            completedSteps.push(2);
            localStorage.setItem('roleferry-progress', JSON.stringify(completedSteps));
          }
        } else {
          throw new Error(response.message || 'Failed to save preferences');
        }
      } catch (error) {
        console.error('Error saving preferences:', error);
        showError('Failed to save preferences: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Save Preferences';
        document.getElementById('preferencesForm').classList.remove('loading');
      }
    });

    function resetForm() {
      document.getElementById('preferencesForm').reset();
      document.getElementById('successMessage').classList.remove('show');
      document.getElementById('errorMessage').classList.remove('show');
    }

    // Load saved data if exists
    async function loadSavedData() {
      try {
        // Try to load from backend first (would need user_id in real app)
        // For now, load from localStorage
        const savedData = localStorage.getItem('roleferry_preferences');
        if (savedData) {
          const data = JSON.parse(savedData);
          
          // Populate form fields
          if (data.values) {
            data.values.forEach(value => {
              const option = Array.from(document.getElementById('values').options).find(opt => opt.value === value);
              if (option) option.selected = true;
            });
          }
          
          if (data.role_categories) {
            data.role_categories.forEach(cat => {
              const option = Array.from(document.getElementById('roleCategories').options).find(opt => opt.value === cat);
              if (option) option.selected = true;
            });
          }
          
          if (data.location_preferences) {
            data.location_preferences.forEach(loc => {
              const option = Array.from(document.getElementById('locationPreferences').options).find(opt => opt.value === loc);
              if (option) option.selected = true;
            });
          }
          
          if (data.work_type) {
            data.work_type.forEach(wt => {
              const option = Array.from(document.getElementById('workType').options).find(opt => opt.value === wt);
              if (option) option.selected = true;
            });
          }
          
          if (data.role_type) {
            data.role_type.forEach(rt => {
              const option = Array.from(document.getElementById('roleType').options).find(opt => opt.value === rt);
              if (option) option.selected = true;
            });
          }
          
          if (data.company_size) {
            data.company_size.forEach(cs => {
              const option = Array.from(document.getElementById('companySize').options).find(opt => opt.value === cs);
              if (option) option.selected = true;
            });
          }
          
          if (data.industries) {
            data.industries.forEach(ind => {
              const option = Array.from(document.getElementById('industries').options).find(opt => opt.value === ind);
              if (option) option.selected = true;
            });
          }
          
          if (data.skills) {
            data.skills.forEach(skill => {
              const option = Array.from(document.getElementById('skills').options).find(opt => opt.value === skill);
              if (option) option.selected = true;
            });
          }
          
          if (data.minimum_salary) {
            document.getElementById('minimumSalary').value = data.minimum_salary;
          }
          
          if (data.job_search_status) {
            document.getElementById('jobSearchStatus').value = data.job_search_status;
          }
          
          if (data.state) {
            document.getElementById('state').value = data.state;
          }
        }
      } catch (error) {
        console.error('Error loading saved data:', error);
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      await loadOptions();
      await loadSavedData();
    });
  </script>
</body>
</html>